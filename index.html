<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GerMaCrise V0.4-Dev</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  /* Corps gÃ©nÃ©ral */
  body { font-family:Arial,sans-serif; margin:0; background:#fafafa; color:#000; transition: background 0.3s, color 0.3s; }
  body.dark { background:#111; color:orange; }

  /* Header */
  header { padding:12px 24px; display:flex; justify-content:space-between; align-items:center; cursor:default; transition: background 0.3s, color 0.3s; }
  header.light { background:#fafafa; color:#000; }
  header.dark { background:#111; color:orange; } /* noir au lieu de gris */

  .header-left { display:flex; align-items:center; }
  .header-left img { height:40px; margin-right:12px; cursor:pointer; }

  /* Main / Navigation / iframe */
  main { display:flex; height:90vh; }
  nav { width:250px; flex-shrink:0; padding:12px; display:flex; flex-direction:column; transition: background 0.3s, color 0.3s; }
  nav.light { background:#fafafa; color:#000; }
  nav.dark { background:#111; color:orange; } /* noir au lieu de gris */

  nav ul { list-style:none; margin:0; padding:0; }
  nav li { margin-bottom:4px; }
  nav li button { width:100%; text-align:left; background:none; border:none; padding:10px; cursor:pointer; transition: background 0.3s, color 0.3s; color:inherit; }
  nav li button.selected { font-weight:bold; background:#dde5ff; color:#000; }
  nav.dark li button.selected { background:rgba(255,165,0,0.2); color:orange; }

  nav li.open > ul { display:block; }
  nav li ul { display:none; padding-left:15px; }
  nav li ul li button { color:inherit; }

  nav li button:hover { background:#cce; }
  nav.dark li button:hover { background:rgba(255,165,0,0.2); }

  iframe { border:none; flex:1; }

  .version { margin-top:auto; text-align:center; font-size:0.9em; color:#888; }

  .toggle-btn { cursor:pointer; font-size:1.2em; user-select:none; }
</style>
</head>
<body>
<header id="header">
  <div class="header-left">
    <img src="images/logo_gmc.jpg" alt="Logo" onclick="chargerPage('apropos.html', null)">
    <div>
      <h1 style="margin:0; font-size:1.4em;">GerMaCrise V0.4-Dev</h1>
      <div style="font-size:0.95em;">POC pour la gestion de crise (offline)</div>
    </div>
  </div>
  <div>
    <span class="toggle-btn" id="themeToggle">ðŸŒž</span>
    <div id="horloge" style="margin-top:4px; font-size:0.9em;"></div>
  </div>
</header>

<main>
  <nav id="sidebar">
    <ul>
      <li>
        <button onclick="toggleSubmenu(this)">Cartographie</button>
        <ul>
          <li><button onclick="chargerPage('cartoff.html', this)">Cartographie (offline)</button></li>
          <li><button onclick="chargerPage('https://map.gaulix.fr', this)">Map Gaulix (online)</button></li>
          <li><button onclick="chargerPage('http://local.terrain', this)">Map Gaulix (offline)</button></li>
        </ul>
      </li>
      <li><button onclick="chargerPage('activation_creation.html', this)">Activation(s)</button></li>
      <li>
        <button onclick="toggleSubmenu(this)">Annuaire(s)</button>
        <ul>
          <li><button onclick="chargerPage('annuaire_crise.html', this)">Annuaire de crise</button></li>
          <li><button onclick="chargerPage('liste_site_industriel.html', this)">Liste sites industriels</button></li>
        </ul>
      </li>
      <li>
        <button onclick="toggleSubmenu(this)">Plan Communal de Sauvegarde</button>
        <ul>
          <li><button onclick="chargerPage('accueil_lieu.html', this)">Accueil lieu</button></li>
          <li><button onclick="chargerPage('gestion_documents.html', this)">Gestion documents</button></li>
        </ul>
      </li>
      <li>
        <button onclick="toggleSubmenu(this)">ParamÃ©trage(s)</button>
        <ul>
          <li><button onclick="chargerPage('utilisateurs.html', this)">Utilisateurs</button></li>
          <li><button onclick="chargerPage('Structure.html', this)">Structures</button></li>
        </ul>
      </li>
      <li><button onclick="chargerPage('apropos.html', this)">Ã€ propos</button></li>
      <li class="version">V0.4-Dev</li>
    </ul>
  </nav>

  <iframe id="contenu" src="apropos.html"></iframe>
</main>

<script>
let currentTheme = localStorage.getItem('theme') || 'light';
const body = document.body;
const header = document.getElementById('header');
const sidebar = document.getElementById('sidebar');
const toggle = document.getElementById('themeToggle');

function appliquerTheme(theme){
  currentTheme = theme;
  localStorage.setItem('theme', theme);

  if(theme === 'dark'){
    body.className = 'dark';
    header.className = 'dark';
    sidebar.className = 'dark';
    toggle.textContent = 'ðŸŒ™';
  } else {
    body.className = '';
    header.className = 'light';
    sidebar.className = 'light';
    toggle.textContent = 'ðŸŒž';
  }

  // envoyer le thÃ¨me Ã  l'iframe
  const iframe = document.getElementById('contenu');
  if(iframe?.contentWindow){
    iframe.contentWindow.postMessage({type:'theme', theme:currentTheme}, '*');
  }
}

toggle.onclick = () => appliquerTheme(currentTheme==='light'?'dark':'light');

function toggleSubmenu(btn){
  const li = btn.parentElement;
  li.classList.toggle('open');
}

function chargerPage(url, btn){
  document.getElementById('contenu').src = url;
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('selected'));
  if(btn) btn.classList.add('selected');
}

function majHorloge(){
  const now = new Date();
  document.getElementById('horloge').textContent =
    now.toLocaleDateString('fr-FR', { weekday:"long", year:"numeric", month:"long", day:"numeric" }) + ' ' +
    now.toLocaleTimeString('fr-FR', { hour:'2-digit', minute:'2-digit' });
}
majHorloge();
setInterval(majHorloge, 60000);

if(!localStorage.getItem('popupShown')){
  alert("ATTENTION : ceci est seulement un POC, un dÃ©monstrateur de ce qu'on peut attendre d'un outil d'aide Ã  la gestion de crise. Vous l'utilisez sans aucune garantie.");
  localStorage.setItem('popupShown','true');
}

document.addEventListener('DOMContentLoaded', ()=>appliquerTheme(currentTheme));

window.addEventListener('message', e=>{
  if(e.data?.type==='requestTheme'){
    e.source.postMessage({type:'theme', theme:currentTheme}, '*');
  }
});
</script>
</body>
</html>
