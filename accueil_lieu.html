<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Lieux d'accueil - GerMaCrise</title>
<style>
body { margin:0; font-family:Arial,sans-serif; transition: background-color 0.3s, color 0.3s; }

/* Th√®mes */
body.light { background-color:#fff; color:#000; }
body.dark { background-color:#000; color:#ff8c00; }

/* Forcer tout le texte en orange en mode sombre */
body.dark, 
body.dark * { color:#ff8c00 !important; background-color:transparent !important; border-color:#ff8c00 !important; }

/* Formulaire et tables */
header { padding:10px; font-size:1.2em; font-weight:bold; }
h2 { margin-top:0; }

.form-section { margin:15px; }
label { display:block; margin-top:10px; }
input, select, textarea, button { width:100%; padding:5px; margin-top:3px; border:1px solid #999; border-radius:4px; transition: background 0.3s, color 0.3s; background-color:#fff; color:#000; }
button { cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #999; padding:5px; text-align:left; }
th { background-color:rgba(0,0,0,0.1); }
th.no-sort { cursor:default; }

/* Ajustement pour le sombre */
body.dark table th { background-color:rgba(255,140,0,0.2) !important; }

p.instruction { font-size:0.9em; color:gray; margin-top:5px; }
</style>
</head>
<body class="light">

<header>Gestion des lieux d'accueil - GerMaCrise</header>

<div class="form-section">
  <button onclick="toggleTheme()">üåó Basculer th√®me clair/sombre</button>
</div>

<div class="form-section">
  <h2>Liste des lieux d'accueil</h2>
  <label>Filtrer par nom ou commune: <input type="text" id="filterInput" onkeyup="filtrerLieux()"></label>
  <table id="tableLieux">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Commune</th>
        <th>Surface (m¬≤)</th>
        <th>Nb accueil</th>
        <th>Nb h√©bergement</th>
        <th>Nb ravitaillement</th>
        <th class="no-sort">Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="exporterJSON()">üì• Exporter en JSON</button>
  <button onclick="importerJSON()">üìÇ Importer JSON</button>
</div>

<div class="form-section">
  <h2>Ajouter / Modifier un lieu</h2>
  <label>Nom du site <input type="text" id="nom_site"></label>
  <label>Commune <select id="commune"></select></label>
  <label>Surface (m¬≤) <input type="number" id="surface"></label>
  <label>Nombre d'accueil <input type="number" id="nb_accueil"></label>
  <label>Nombre d'h√©bergement <input type="number" id="nb_hebergement"></label>
  <label>Nombre de ravitaillement <input type="number" id="nb_ravitaillement"></label>
  <label>Autres ressources <textarea id="autres_ressource"></textarea></label>
  <label>T√©l√©phone du responsable <input type="text" id="telephone_responsable"></label>
  <label>Adresse <textarea id="adresse"></textarea></label>
  <button onclick="ajouterLieu()">Ajouter / Modifier</button>
  <button onclick="resetForm()">Annuler</button>
</div>

<script>
// --- Th√®me ---
function appliquerTheme(theme){
  document.body.className = theme;
  localStorage.setItem("theme", theme);
}

function toggleTheme(){
  const nouveau = document.body.className === 'dark' ? 'light' : 'dark';
  appliquerTheme(nouveau);
}

// Charger th√®me depuis le localStorage
document.addEventListener('DOMContentLoaded', ()=>{
  const theme = localStorage.getItem("theme") || 'light';
  appliquerTheme(theme);

  // Charger communes fictives pour test
  const select = document.getElementById('commune');
  ['Saint-√âtienne','Roanne','Saint-Chamond'].forEach(c=>{
    const o = document.createElement('option'); o.value=c; o.textContent=c; select.appendChild(o);
  });

  afficherLieux();
});

// --- Donn√©es ---
let lieux = [
  {id:'1', nom_site:'Salle des f√™tes', commune:'Saint-√âtienne', surface:500, nb_accueil:50, nb_hebergement:30, nb_ravitaillement:20, autres_ressource:'Cuisine √©quip√©e', telephone_responsable:'0477123456', adresse:'1 rue de la Paix'},
  {id:'2', nom_site:'Gymnase central', commune:'Roanne', surface:800, nb_accueil:100, nb_hebergement:50, nb_ravitaillement:40, autres_ressource:'Vestiaires, douches', telephone_responsable:'0477356789', adresse:'10 avenue des Sports'},
  {id:'3', nom_site:'Centre communautaire', commune:'Saint-Chamond', surface:300, nb_accueil:30, nb_hebergement:20, nb_ravitaillement:10, autres_ressource:'Salle polyvalente', telephone_responsable:'0477234567', adresse:'5 place du March√©'}
];
let editIndex = null;

// --- Fonctions ---
function afficherLieux(){
  const tbody = document.getElementById('tableLieux').querySelector('tbody');
  tbody.innerHTML='';
  lieux.forEach((l,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${l.nom_site}</td>
      <td>${l.commune}</td>
      <td>${l.surface}</td>
      <td>${l.nb_accueil}</td>
      <td>${l.nb_hebergement}</td>
      <td>${l.nb_ravitaillement}</td>
      <td>
        <button onclick="modifierLieu(${index})">‚úè</button>
        <button onclick="supprimerLieu(${index})">üóë</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function ajouterLieu(){
  const nom_site=document.getElementById('nom_site').value.trim();
  const commune=document.getElementById('commune').value;
  if(!nom_site||!commune){ alert("Veuillez remplir le nom du site et la commune"); return; }
  const lieu={id:editIndex!==null?lieux[editIndex].id:'lieu_'+Date.now(),
    nom_site, commune,
    surface:parseInt(document.getElementById('surface').value)||0,
    nb_accueil:parseInt(document.getElementById('nb_accueil').value)||0,
    nb_hebergement:parseInt(document.getElementById('nb_hebergement').value)||0,
    nb_ravitaillement:parseInt(document.getElementById('nb_ravitaillement').value)||0,
    autres_ressource:document.getElementById('autres_ressource').value.trim(),
    telephone_responsable:document.getElementById('telephone_responsable').value.trim(),
    adresse:document.getElementById('adresse').value.trim()};
  if(editIndex!==null){ lieux[editIndex]=lieu; editIndex=null; } else { lieux.push(lieu); }
  afficherLieux();
  resetForm();
}

function modifierLieu(index){
  const l=lieux[index];
  document.getElementById('nom_site').value=l.nom_site;
  document.getElementById('commune').value=l.commune;
  document.getElementById('surface').value=l.surface;
  document.getElementById('nb_accueil').value=l.nb_accueil;
  document.getElementById('nb_hebergement').value=l.nb_hebergement;
  document.getElementById('nb_ravitaillement').value=l.nb_ravitaillement;
  document.getElementById('autres_ressource').value=l.autres_ressource;
  document.getElementById('telephone_responsable').value=l.telephone_responsable;
  document.getElementById('adresse').value=l.adresse;
  editIndex=index;
}

function supprimerLieu(index){ if(confirm("Supprimer ce lieu ?")){ lieux.splice(index,1); afficherLieux(); } }
function resetForm(){ ['nom_site','commune','surface','nb_accueil','nb_hebergement','nb_ravitaillement','autres_ressource','telephone_responsable','adresse'].forEach(id=>document.getElementById(id).value=''); editIndex=null; }
function filtrerLieux(){
  const filter=document.getElementById('filterInput').value.toLowerCase();
  const tbody=document.getElementById('tableLieux').querySelector('tbody');
  Array.from(tbody.rows).forEach(row=>{
    const nom=row.cells[0].textContent.toLowerCase();
    const commune=row.cells[1].textContent.toLowerCase();
    row.style.display=(nom.includes(filter)||commune.includes(filter))?'':'none';
  });
}

function exporterJSON(){
  const dataStr=JSON.stringify({lieux_accueil: lieux}, null, 2);
  const blob=new Blob([dataStr], { type:"application/json" });
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download="accueil_lieu.json"; a.click();
}

function importerJSON(){
  const fileInput=document.createElement('input'); fileInput.type='file'; fileInput.accept='.json';
  fileInput.onchange=e=>{
    const file=e.target.files[0]; if(!file){ alert("Aucun fichier s√©lectionn√©"); return; }
    const reader=new FileReader();
    reader.onload=ev=>{
      try{
        const json=JSON.parse(ev.target.result);
        if(!Array.isArray(json.lieux_accueil)) throw "JSON invalide";
        lieux=json.lieux_accueil; afficherLieux(); alert("Importation r√©ussie !");
      } catch(err){ alert("Erreur lecture JSON: "+err); }
    };
    reader.readAsText(file);
  };
  fileInput.click();
}
</script>

</body>
</html>
