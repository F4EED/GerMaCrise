<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Suivi des activations - GerMaCrise</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; font-family:Arial,sans-serif; transition: background 0.3s, color 0.3s; }
  body.light { background:#fff; color:#000; }
  body.dark { background:#000; color:#ffd700; }

  header { padding:10px; font-size:1.2em; font-weight:bold; }
  h2 { margin-top:0; }

  .form-section { margin:15px; }
  label { display:block; margin-top:10px; }
  input, select, textarea, button { width:100%; padding:5px; margin-top:3px; transition: background 0.3s, color 0.3s, border 0.3s; }

  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { border:1px solid #999; padding:5px; text-align:left; }
  th { background-color:rgba(0,0,0,0.1); }

  body.dark table th { background-color:rgba(255,215,0,0.2); }
  body.dark input, body.dark select, body.dark textarea, body.dark button { background:#333; color:#ffd700; border:1px solid #ffd700; }
</style>
</head>
<body class="light">

<header>Suivi des activations - GerMaCrise</header>

<div class="form-section">
  <h2>Liste des activations</h2>
  <table id="tableActivations">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Date</th>
        <th>Responsable</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="exporterJSON()">üì• Exporter en JSON</button>
</div>

<div class="form-section">
  <h2>Ajouter / Modifier une activation</h2>
  <label>ID <input type="text" id="idAct" readonly></label>
  <label>Nom <input type="text" id="nomAct"></label>
  <label>Date <input type="date" id="dateAct"></label>
  <label>Responsable <input type="text" id="responsableAct"></label>
  <label>Status 
    <select id="statusAct">
      <option value="en_cours">En cours</option>
      <option value="terminee">Termin√©e</option>
      <option value="annulee">Annul√©e</option>
    </select>
  </label>
  <button onclick="sauvegarderActivation()">Enregistrer</button>
  <button onclick="resetForm()">Annuler</button>
</div>

<script>
  // === Th√®me : appliquer imm√©diatement depuis le parent ===
  function appliquerTheme(theme){
    document.body.className = theme==='dark' ? 'dark' : 'light';
  }

  // √âcouter le th√®me envoy√© par le parent
  window.addEventListener('message', e=>{
    if(e.data?.type==='theme' && e.data.theme){
      appliquerTheme(e.data.theme);
    }
  });

  // === Gestion des activations ===
  let activations = [];
  let editIndex = null;

  function afficherActivations(){
    const tbody = document.querySelector('#tableActivations tbody');
    tbody.innerHTML = '';
    activations.forEach((a,index)=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${a.id}</td>
        <td>${a.nom}</td>
        <td>${a.date}</td>
        <td>${a.responsable}</td>
        <td>${a.status}</td>
        <td>
          <button onclick="modifierActivation(${index})">‚úè</button>
          <button onclick="supprimerActivation(${index})">üóë</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function resetForm(){
    ['idAct','nomAct','dateAct','responsableAct','statusAct'].forEach(id => document.getElementById(id).value='');
    editIndex = null;
  }

  function modifierActivation(index){
    const a = activations[index];
    document.getElementById('idAct').value = a.id;
    document.getElementById('nomAct').value = a.nom;
    document.getElementById('dateAct').value = a.date;
    document.getElementById('responsableAct').value = a.responsable;
    document.getElementById('statusAct').value = a.status;
    editIndex = index;
  }

  function sauvegarderActivation(){
    const id = editIndex!==null ? activations[editIndex].id : 'act_'+Date.now();
    const act = {
      id,
      nom: document.getElementById('nomAct').value.trim(),
      date: document.getElementById('dateAct').value,
      responsable: document.getElementById('responsableAct').value.trim(),
      status: document.getElementById('statusAct').value
    };
    if(editIndex!==null){
      activations[editIndex] = act;
    } else {
      activations.push(act);
    }
    afficherActivations();
    resetForm();
  }

  function supprimerActivation(index){
    if(confirm("Supprimer cette activation ?")){
      activations.splice(index,1);
      afficherActivations();
    }
  }

  function exporterJSON(){
    const dataStr = JSON.stringify(activations,null,2);
    const blob = new Blob([dataStr], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "activations.json";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // Initialisation avec quelques donn√©es de test
  window.addEventListener('DOMContentLoaded', ()=>{
    activations = [
      {id:'1', nom:'Activation A', date:'2025-09-25', responsable:'Jean', status:'en_cours'},
      {id:'2', nom:'Activation B', date:'2025-09-26', responsable:'Marie', status:'terminee'}
    ];
    afficherActivations();
    resetForm();
  });
</script>
</body>
</html>
